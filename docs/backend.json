{
  "entities": {
    "Store": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Store",
      "type": "object",
      "description": "Represents a store account on the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the store entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the store."
        },
        "description": {
          "type": "string",
          "description": "Description of the store and its offerings."
        },
        "location": {
          "type": "string",
          "description": "Physical address or location details of the store."
        },
        "contactEmail": {
          "type": "string",
          "description": "Email address for contacting the store.",
          "format": "email"
        },
        "contactPhone": {
          "type": "string",
          "description": "Phone number for contacting the store."
        },
        "openingHours": {
          "type": "string",
          "description": "Store's opening hours."
        }
      },
      "required": [
        "id",
        "name",
        "location"
      ]
    },
    "DeliveryPersonnel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DeliveryPersonnel",
      "type": "object",
      "description": "Represents a delivery personnel account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the delivery personnel entity."
        },
        "name": {
          "type": "string",
          "description": "Full name of the delivery personnel."
        },
        "contactPhone": {
          "type": "string",
          "description": "Phone number of the delivery personnel."
        },
        "deliveryZone": {
          "type": "string",
          "description": "Area or zone assigned for deliveries."
        },
        "rating": {
          "type": "number",
          "description": "Average rating of the delivery personnel based on customer reviews."
        }
      },
      "required": [
        "id",
        "name",
        "contactPhone",
        "deliveryZone"
      ]
    },
    "Admin": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Admin",
      "type": "object",
      "description": "Represents an administrator account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin entity."
        },
        "name": {
          "type": "string",
          "description": "Admin's full name."
        },
        "email": {
          "type": "string",
          "description": "Admin's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role or permission level of the admin (e.g., superadmin, moderator)."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role"
      ]
    },
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an item for sale in a store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the item entity."
        },
        "storeId": {
          "type": "string",
          "description": "Reference to Store. (Relationship: Store 1:N Item)"
        },
        "name": {
          "type": "string",
          "description": "Name of the item."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the item."
        },
        "price": {
          "type": "number",
          "description": "Price of the item."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the item's image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "storeId",
        "name",
        "price"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order entity."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Order)"
        },
        "storeId": {
          "type": "string",
          "description": "Reference to Store. (Relationship: Store 1:N Order)"
        },
        "deliveryPersonnelId": {
          "type": "string",
          "description": "Reference to DeliveryPersonnel. (Relationship: DeliveryPersonnel 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date and time when the order was placed.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the order (e.g., pending, processing, delivered)."
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        }
      },
      "required": [
        "id",
        "customerId",
        "storeId",
        "orderDate",
        "status",
        "totalAmount"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer account.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer entity."
        },
        "name": {
          "type": "string",
          "description": "Customer's full name."
        },
        "email": {
          "type": "string",
          "description": "Customer's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "Customer's phone number."
        },
        "address": {
          "type": "string",
          "description": "Customer's shipping address."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "phoneNumber"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item entity."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "itemId": {
          "type": "string",
          "description": "Reference to Item. (Relationship: Item 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the item in the order."
        },
        "price": {
          "type": "number",
          "description": "Price of the item at the time of order."
        }
      },
      "required": [
        "id",
        "orderId",
        "itemId",
        "quantity",
        "price"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a customer review for delivery personnel.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review entity."
        },
        "deliveryPersonnelId": {
          "type": "string",
          "description": "Reference to DeliveryPersonnel. (Relationship: DeliveryPersonnel 1:N Review)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the customer."
        },
        "comment": {
          "type": "string",
          "description": "Text comment provided by the customer."
        },
        "tags": {
          "type": "array",
          "description": "Tags generated based on comment analysis",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "deliveryPersonnelId",
        "customerId",
        "rating"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/stores/{storeId}",
        "definition": {
          "entityName": "Store",
          "schema": {
            "$ref": "#/backend/entities/Store"
          },
          "description": "Stores account information. Top-level collection.",
          "params": [
            {
              "name": "storeId",
              "description": "The unique identifier of the store."
            }
          ]
        }
      },
      {
        "path": "/stores/{storeId}/items/{itemId}",
        "definition": {
          "entityName": "Item",
          "schema": {
            "$ref": "#/backend/entities/Item"
          },
          "description": "Items available for sale at each store. Includes denormalized 'storeId' for authorization independence.",
          "params": [
            {
              "name": "storeId",
              "description": "The unique identifier of the store."
            },
            {
              "name": "itemId",
              "description": "The unique identifier of the item."
            }
          ]
        }
      },
      {
        "path": "/delivery_personnel/{deliveryPersonnelId}",
        "definition": {
          "entityName": "DeliveryPersonnel",
          "schema": {
            "$ref": "#/backend/entities/DeliveryPersonnel"
          },
          "description": "Delivery personnel accounts.",
          "params": [
            {
              "name": "deliveryPersonnelId",
              "description": "The unique identifier of the delivery personnel."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "Admin",
          "schema": {
            "$ref": "#/backend/entities/Admin"
          },
          "description": "Admin role assignment. Presence of a document grants admin privileges.",
          "params": [
            {
              "name": "uid",
              "description": "The Firebase Auth UID of the admin user."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Customer accounts.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier of the customer."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Orders placed by customers. Includes denormalized 'customerId', 'storeId', and 'deliveryPersonnelId' for authorization independence.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier of the customer."
            },
            {
              "name": "orderId",
              "description": "The unique identifier of the order."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/orders/{orderId}/order_items/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Items within an order.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier of the customer."
            },
            {
              "name": "orderId",
              "description": "The unique identifier of the order."
            },
            {
              "name": "orderItemId",
              "description": "The unique identifier of the order item."
            }
          ]
        }
      },
      {
        "path": "/delivery_personnel/{deliveryPersonnelId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Customer reviews for delivery personnel. Includes denormalized 'deliveryPersonnelId' and 'customerId' for authorization independence.",
          "params": [
            {
              "name": "deliveryPersonnelId",
              "description": "The unique identifier of the delivery personnel."
            },
            {
              "name": "reviewId",
              "description": "The unique identifier of the review."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the 'EncomiendaYA' application, focusing on secure and scalable data management for stores, delivery personnel, admins, items, orders, customers, order items, and reviews. The structure prioritizes authorization independence, clarity, and predictable security rules. It leverages structural segregation and denormalization to optimize security and performance.\n\n**Authorization Independence (Denormalization):**\n\n*   The `items` subcollection under each store includes the `storeId`. This allows reading and writing items with security rules that validate the request's `auth.uid` against the `storeId` without needing to `get()` the store document.\n*   Orders store both `customerId` and `storeId` and `deliveryPersonnelId` directly within the document, enabling security rules to be enforced based on the authenticated user's ID without requiring hierarchical lookups.\n*   Reviews store both `customerId` and `deliveryPersonnelId` directly within the document, enabling security rules to be enforced based on the authenticated user's ID without requiring hierarchical lookups.\n\n**Structural Segregation:**\n\n*   `admins` are stored in a separate collection (`/roles_admin/{uid}`) for global role management using existence checks. This allows for clearly defined security rules based on the presence of a document in this collection.\n\n**Access Modeling:**\n\n*   User-owned data: The structure uses path-based ownership for orders and reviews, making it straightforward to implement security rules based on the authenticated user's ID and the document path.\n\n**QAPs (Rules are not Filters):**\n\nThe structure enables secure list operations by adhering to structural segregation (all documents in a collection share the same security requirements) and denormalization (authorization context is included within each document)."
  }
}